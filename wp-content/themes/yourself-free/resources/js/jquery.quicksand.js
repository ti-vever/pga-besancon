/*
Quicksand 1.2.2
Reorder and filter items with a nice shuffling animation.
Copyright (c) 2010 Jacek Galanciak (razorjack.net) and agilope.com
Big thanks for Piotr Petrus (riddle.pl) for deep code review and wonderful docs & demos.
Dual licensed under the MIT and GPL version 2 licenses.
http://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt
http://github.com/jquery/jquery/blob/master/GPL-LICENSE.txt
Project site: http://razorjack.net/quicksand
Github site: http://github.com/razorjack/quicksand
*/

(function(e){e.fn.quicksand=function(t,n){var r={duration:750,easing:"swing",attribute:"data-id",adjustHeight:"auto",useScaling:true,enhancement:function(e){},selector:"> *",dx:0,dy:0};e.extend(r,n);if(e.browser.msie||typeof e.fn.scale=="undefined"){r.useScaling=false}var i;if(typeof arguments[1]=="function"){var i=arguments[1]}else if(typeof (arguments[2]=="function")){var i=arguments[2]}return this.each(function(n){var s;var o=[];var u=e(t).clone();var a=e(this);var f=e(this).css("height");var l;var c=false;var h=e(a).offset();var p=[];var v=e(this).find(r.selector);var m=e(v).innerWidth();if(e.browser.msie&&e.browser.version.substr(0,1)<7){a.html("").append(u);return}var g=0;var y=function(){if(!g){g=1;$toDelete=a.find("> *");a.prepend(x.find("> *"));$toDelete.remove();if(c){a.css("height",l)}r.enhancement(a);if(typeof i=="function"){i.call(this)}}};var b=a.offsetParent();var w=b.offset();if(b.css("position")=="relative"){if(b.get(0).nodeName.toLowerCase()=="body"){}else{w.top+=parseFloat(b.css("border-top-width"))||0;w.left+=parseFloat(b.css("border-left-width"))||0}}else{w.top-=parseFloat(b.css("border-top-width"))||0;w.left-=parseFloat(b.css("border-left-width"))||0;w.top-=parseFloat(b.css("margin-top"))||0;w.left-=parseFloat(b.css("margin-left"))||0}if(isNaN(w.left)){w.left=0}if(isNaN(w.top)){w.top=0}w.left-=r.dx;w.top-=r.dy;a.css("height",e(this).height());v.each(function(t){p[t]=e(this).offset()});e(this).stop();var E=0;var S=0;v.each(function(t){e(this).stop();var n=e(this).get(0);if(n.style.position=="absolute"){E=-r.dx;S=-r.dy}else{E=r.dx;S=r.dy}n.style.position="absolute";n.style.margin="0";n.style.width=m+"px";n.style.top=p[t].top-parseFloat(n.style.marginTop)-w.top+S+"px";n.style.left=p[t].left-parseFloat(n.style.marginLeft)-w.left+E+"px"});var x=e(a).clone();var T=x.get(0);T.innerHTML="";T.setAttribute("id","");T.style.height="auto";T.style.width=a.width()+"px";x.append(u);x.insertBefore(a);x.css("opacity",0);T.style.zIndex=-1;T.style.margin="0";T.style.position="absolute";T.style.top=h.top-w.top+"px";T.style.left=h.left-w.left+"px";if(r.adjustHeight==="dynamic"){a.animate({height:x.height()},r.duration,r.easing)}else if(r.adjustHeight==="auto"){l=x.height();if(parseFloat(f)<parseFloat(l)){a.css("height",l)}else{c=true}}v.each(function(t){var n=[];if(typeof r.attribute=="function"){s=r.attribute(e(this));u.each(function(){if(r.attribute(this)==s){n=e(this);return false}})}else{n=u.filter("["+r.attribute+"="+e(this).attr(r.attribute)+"]")}if(n.length){if(!r.useScaling){o.push({element:e(this),animation:{top:n.offset().top-w.top,left:n.offset().left-w.left,opacity:1}})}else{o.push({element:e(this),animation:{top:n.offset().top-w.top,left:n.offset().left-w.left,opacity:1,scale:"1.0"}})}}else{if(!r.useScaling){o.push({element:e(this),animation:{opacity:"0.0"}})}else{o.push({element:e(this),animation:{opacity:"0.0",scale:"0.0"}})}}});u.each(function(t){var n=[];var i=[];if(typeof r.attribute=="function"){s=r.attribute(e(this));v.each(function(){if(r.attribute(this)==s){n=e(this);return false}});u.each(function(){if(r.attribute(this)==s){i=e(this);return false}})}else{n=v.filter("["+r.attribute+"="+e(this).attr(r.attribute)+"]");i=u.filter("["+r.attribute+"="+e(this).attr(r.attribute)+"]")}var f;if(n.length===0){if(!r.useScaling){f={opacity:"1.0"}}else{f={opacity:"1.0",scale:"1.0"}}d=i.clone();var l=d.get(0);l.style.position="absolute";l.style.margin="0";l.style.width=m+"px";l.style.top=i.offset().top-w.top+"px";l.style.left=i.offset().left-w.left+"px";d.css("opacity",0);if(r.useScaling){d.css("transform","scale(0.0)")}d.appendTo(a);o.push({element:e(d),animation:f})}});x.remove();r.enhancement(a);for(n=0;n<o.length;n++){o[n].element.animate(o[n].animation,r.duration,r.easing,y)}})}})(jQuery)